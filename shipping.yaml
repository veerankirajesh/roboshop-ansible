- name: install shipping component
  hosts: shipping
  become: yes

  tasks:
   - name: Install maven #ansible dnf packages
     ansible.builtin.dnf:
      name: maven
      state: present

   - name: create roboshop user # ansible adduseer module
     ansible.builtin.user:
      name: roboshop 

   - name: Recursively remove app directory # ansible app directory
     ansible.builtin.file:
      path: /app
      state: absent 

   - name: create app directory # ansible app directory
     ansible.builtin.file:
      path: /app
      state: directory  

   - name: Download for shipping application # ansible download module
     ansible.builtin.get_url:
      url: https://roboshop-builds.s3.amazonaws.com/shipping.zip
      dest: /app

   - name: extract shipping application
     ansible.builtin.unarchive:
      src: /tmp/shipping.sqlp
      dest: /app
      remote_src: yes  

   - name:  install dependencies
     ansible.builtin.command: mvn clean package
     args:
       chdir: /app  

   - name: rename jar file
     ansible.builtin.command: mv target/shipping-1.0.jar shipping.jar
     args:
       chdir: /app 

   - name: copy shipping service
     ansible.builtin.copy:
      src: shipping.service
      dest: /etc/systemd/system/shipping.service   